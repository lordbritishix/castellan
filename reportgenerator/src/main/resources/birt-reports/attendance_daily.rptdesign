<?xml version="1.0" encoding="UTF-8"?>
<report xmlns="http://www.eclipse.org/birt/2005/design" version="3.2.23" id="1">
    <property name="createdBy">Eclipse BIRT Designer Version 4.5.0.v201506092134 Build &lt;@BUILD@></property>
    <property name="units">in</property>
    <property name="iconFile">/templates/blank_report.gif</property>
    <property name="bidiLayoutOrientation">ltr</property>
    <property name="imageDPI">96</property>
    <parameters>
        <scalar-parameter name="dataSource" id="183">
            <property name="valueType">static</property>
            <property name="dataType">string</property>
            <property name="distinct">true</property>
            <list-property name="selectionList"/>
            <property name="paramType">simple</property>
            <property name="controlType">text-box</property>
            <structure name="format">
                <property name="category">Unformatted</property>
            </structure>
        </scalar-parameter>
    </parameters>
    <data-sources>
        <script-data-source name="dailyAttendanceSource" id="30"/>
    </data-sources>
    <data-sets>
        <script-data-set name="AttendanceDataSet" id="31">
            <list-property name="resultSetHints">
                <structure>
                    <property name="position">1</property>
                    <property name="name">reportId</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">2</property>
                    <property name="name">reportGeneratedAt</property>
                    <property name="dataType">date-time</property>
                </structure>
            </list-property>
            <list-property name="columnHints">
                <structure>
                    <property name="columnName">reportId</property>
                </structure>
                <structure>
                    <property name="columnName">reportGeneratedAt</property>
                </structure>
            </list-property>
            <structure name="cachedMetaData">
                <list-property name="resultSet">
                    <structure>
                        <property name="position">1</property>
                        <property name="name">reportId</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">2</property>
                        <property name="name">reportGeneratedAt</property>
                        <property name="dataType">date-time</property>
                    </structure>
                </list-property>
            </structure>
            <property name="dataSource">dailyAttendanceSource</property>
            <method name="open"><![CDATA[importPackage(Packages.java.nio.file); 
importPackage(Packages.java.lang); 
importPackage(Packages.org.codehaus.jackson.map);
importPackage(Packages.org.codehaus.jackson);

ctr = 0;

System.out.println("Generating UserReport dataset from " + params["dataSource"].value);

input = new String(Files.readAllBytes(Paths.get(params["dataSource"].value)));
mapper = new ObjectMapper();
jsonData = mapper.readTree(input);]]></method>
            <method name="fetch"><![CDATA[if (ctr < 1) {
	row.reportId = jsonData.get("reportId").asText();
	row.reportGeneratedAt = jsonData.get("reportedGeneratedAt").asText();
	
	ctr++;
	
	return true;
}

return false;]]></method>
            <method name="close"><![CDATA[input = null;
mapper = null;
jsonData = null;
ctr = 0;]]></method>
        </script-data-set>
        <script-data-set name="UserReport" id="117">
            <list-property name="resultSetHints">
                <structure>
                    <property name="position">1</property>
                    <property name="name">start</property>
                    <property name="dataType">date-time</property>
                </structure>
                <structure>
                    <property name="position">2</property>
                    <property name="name">end</property>
                    <property name="dataType">date-time</property>
                </structure>
                <structure>
                    <property name="position">3</property>
                    <property name="name">userName</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">4</property>
                    <property name="name">workDuration</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">5</property>
                    <property name="name">activityDuration</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">6</property>
                    <property name="name">inactivePeriods</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">7</property>
                    <property name="name">inactiveDuration</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">8</property>
                    <property name="name">inactivePeriodDurations</property>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="position">9</property>
                    <property name="name">error</property>
                    <property name="dataType">string</property>
                </structure>
            </list-property>
            <list-property name="columnHints">
                <structure>
                    <property name="columnName">start</property>
                </structure>
                <structure>
                    <property name="columnName">end</property>
                </structure>
                <structure>
                    <property name="columnName">userName</property>
                </structure>
                <structure>
                    <property name="columnName">workDuration</property>
                </structure>
                <structure>
                    <property name="columnName">activityDuration</property>
                </structure>
                <structure>
                    <property name="columnName">inactivePeriods</property>
                </structure>
                <structure>
                    <property name="columnName">inactiveDuration</property>
                </structure>
                <structure>
                    <property name="columnName">inactivePeriodDurations</property>
                </structure>
                <structure>
                    <property name="columnName">error</property>
                </structure>
            </list-property>
            <structure name="cachedMetaData">
                <list-property name="resultSet">
                    <structure>
                        <property name="position">1</property>
                        <property name="name">start</property>
                        <property name="dataType">date-time</property>
                    </structure>
                    <structure>
                        <property name="position">2</property>
                        <property name="name">end</property>
                        <property name="dataType">date-time</property>
                    </structure>
                    <structure>
                        <property name="position">3</property>
                        <property name="name">userName</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">4</property>
                        <property name="name">workDuration</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">5</property>
                        <property name="name">activityDuration</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">6</property>
                        <property name="name">inactivePeriods</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">7</property>
                        <property name="name">inactiveDuration</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">8</property>
                        <property name="name">inactivePeriodDurations</property>
                        <property name="dataType">string</property>
                    </structure>
                    <structure>
                        <property name="position">9</property>
                        <property name="name">error</property>
                        <property name="dataType">string</property>
                    </structure>
                </list-property>
            </structure>
            <property name="dataSource">dailyAttendanceSource</property>
            <method name="open"><![CDATA[importPackage(Packages.java.nio.file); 
importPackage(Packages.java.lang); 
importPackage(Packages.org.codehaus.jackson.map);
importPackage(Packages.org.codehaus.jackson);

ctr = 0;
System.out.println("Generating UserReport dataset from " + params["dataSource"].value);

input = new String(Files.readAllBytes(Paths.get(params["dataSource"].value)));
mapper = new ObjectMapper();
root = mapper.readTree(input);

//Only concerned about daily report, so only get the first session
userReport = root.get("userReports").get(0);
report = userReport.get("report");]]></method>
            <method name="fetch"><![CDATA[if (ctr < report.size()) {   
    reportData = report.get(ctr);

    row.userName = reportData.get("userName").asText();
    row.start = reportData.get("startTime").asText();
    row.end = reportData.get("endTime").asText();
    row.activityDuration = reportData.get("activityDuration").asText();
    row.workDuration = reportData.get("workDuration").asText();
    
    size = reportData.path("inactivePeriods").size();
    
    row.inactivePeriods = "";
    row.inactivePeriodDurations = "";
    
    if (size <= 0) {
        row.inactivePeriods = "None";
        row.inactivePeriodDurations = "";        
    }
    else {
	    for (x = 0; x < size; ++x) {
	        row.inactivePeriods += reportData.path("inactivePeriods").path(x).get("period").asText();  
	        row.inactivePeriods += "\n";  
	        
            row.inactivePeriodDurations += reportData.path("inactivePeriods").path(x).get("duration").asText();  
            row.inactivePeriodDurations += "\n";  	        
	    }
    }
    
    if (reportData.get("hasErrors").asBoolean()) {
        row.error = "Note: " + reportData.get("errorDescription").asText();
    }
    
    row.inactiveDuration = reportData.path("inactivityDuration").asText();
    
    ctr++;
    return true;
}

return false;]]></method>
            <method name="close"><![CDATA[input = null;
mapper = null;
jsonData = null;
ctr = 0;]]></method>
        </script-data-set>
    </data-sets>
    <page-setup>
        <simple-master-page name="Simple MasterPage" id="2">
            <page-header>
                <grid id="109">
                    <column id="110"/>
                    <column id="111"/>
                    <row id="112">
                        <cell id="113">
                            <label id="115">
                                <property name="fontSize">x-large</property>
                                <property name="fontWeight">bold</property>
                                <text-property name="text">Attendance Report</text-property>
                            </label>
                        </cell>
                        <cell id="114">
                            <data id="318">
                                <property name="fontSize">x-large</property>
                                <structure name="dateTimeFormat">
                                    <property name="category">Long Date</property>
                                    <property name="pattern">Long Date</property>
                                </structure>
                                <property name="textAlign">right</property>
                                <property name="dataSet">AttendanceDataSet</property>
                                <list-property name="boundDataColumns">
                                    <structure>
                                        <property name="name">reportGeneratedAt</property>
                                        <text-property name="displayName">reportGeneratedAt</text-property>
                                        <expression name="expression" type="javascript">dataSetRow["reportGeneratedAt"]</expression>
                                        <property name="dataType">date-time</property>
                                    </structure>
                                </list-property>
                                <property name="resultSetColumn">reportGeneratedAt</property>
                            </data>
                        </cell>
                    </row>
                </grid>
            </page-header>
        </simple-master-page>
    </page-setup>
    <body>
        <list id="219">
            <property name="dataSet">UserReport</property>
            <list-property name="boundDataColumns">
                <structure>
                    <property name="name">userName</property>
                    <text-property name="displayName">userName</text-property>
                    <expression name="expression" type="javascript">dataSetRow["userName"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">start</property>
                    <text-property name="displayName">start</text-property>
                    <expression name="expression" type="javascript">dataSetRow["start"]</expression>
                    <property name="dataType">date-time</property>
                    <property name="allowExport">true</property>
                </structure>
                <structure>
                    <property name="name">end</property>
                    <text-property name="displayName">end</text-property>
                    <expression name="expression" type="javascript">dataSetRow["end"]</expression>
                    <property name="dataType">date-time</property>
                    <property name="allowExport">true</property>
                </structure>
                <structure>
                    <property name="name">activityDuration</property>
                    <text-property name="displayName">activityDuration</text-property>
                    <expression name="expression" type="javascript">dataSetRow["activityDuration"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">workDuration</property>
                    <text-property name="displayName">workDuration</text-property>
                    <expression name="expression" type="javascript">dataSetRow["workDuration"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">inactivePeriods</property>
                    <text-property name="displayName">inactivePeriods</text-property>
                    <expression name="expression" type="javascript">dataSetRow["inactivePeriods"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">inactiveDuration</property>
                    <text-property name="displayName">inactiveDuration</text-property>
                    <expression name="expression" type="javascript">dataSetRow["inactiveDuration"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">inactivePeriodDurations</property>
                    <text-property name="displayName">inactivePeriodDurations</text-property>
                    <expression name="expression" type="javascript">dataSetRow["inactivePeriodDurations"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">error</property>
                    <text-property name="displayName">error</text-property>
                    <expression name="expression" type="javascript">dataSetRow["error"]</expression>
                    <property name="dataType">string</property>
                </structure>
                <structure>
                    <property name="name">start_1</property>
                    <text-property name="displayName">start</text-property>
                    <expression name="expression" type="javascript">dataSetRow["start"]</expression>
                    <property name="dataType">date-time</property>
                </structure>
                <structure>
                    <property name="name">end_1</property>
                    <text-property name="displayName">end</text-property>
                    <expression name="expression" type="javascript">dataSetRow["end"]</expression>
                    <property name="dataType">date-time</property>
                </structure>
            </list-property>
            <detail>
                <grid id="256">
                    <property name="borderBottomStyle">none</property>
                    <property name="borderLeftStyle">none</property>
                    <property name="borderRightStyle">none</property>
                    <property name="borderTopStyle">none</property>
                    <property name="marginBottom">10pt</property>
                    <property name="width">7.854166666666667in</property>
                    <column id="257">
                        <property name="width">1.5104166666666667in</property>
                    </column>
                    <column id="258">
                        <property name="width">1.78125in</property>
                    </column>
                    <column id="297">
                        <property name="width">3.5208333333333335in</property>
                    </column>
                    <column id="307">
                        <property name="width">1.0416666666666667in</property>
                    </column>
                    <row id="259">
                        <cell id="260">
                            <property name="borderBottomStyle">solid</property>
                            <property name="borderBottomWidth">medium</property>
                            <property name="borderLeftStyle">solid</property>
                            <property name="borderLeftWidth">medium</property>
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                            <property name="borderTopStyle">solid</property>
                            <property name="borderTopWidth">medium</property>
                            <data id="274">
                                <property name="borderBottomStyle">none</property>
                                <property name="borderLeftStyle">none</property>
                                <property name="borderRightStyle">none</property>
                                <property name="borderTopStyle">none</property>
                                <property name="resultSetColumn">userName</property>
                            </data>
                        </cell>
                        <cell id="261"/>
                        <cell id="290"/>
                        <cell id="300"/>
                    </row>
                    <row id="309">
                        <property name="borderLeftStyle">solid</property>
                        <property name="borderLeftWidth">medium</property>
                        <property name="borderRightStyle">solid</property>
                        <property name="borderRightWidth">medium</property>
                        <property name="borderTopStyle">solid</property>
                        <property name="borderTopWidth">medium</property>
                        <cell id="310">
                            <property name="borderBottomStyle">none</property>
                            <property name="borderLeftStyle">none</property>
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                            <property name="borderTopStyle">none</property>
                        </cell>
                        <cell id="311">
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                        </cell>
                        <cell id="312">
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                            <label id="314">
                                <text-property name="text">Inactive</text-property>
                            </label>
                        </cell>
                        <cell id="313">
                            <label id="308">
                                <text-property name="text">Total</text-property>
                            </label>
                        </cell>
                    </row>
                    <row id="262">
                        <property name="borderLeftStyle">solid</property>
                        <property name="borderLeftWidth">medium</property>
                        <property name="borderRightStyle">solid</property>
                        <property name="borderRightWidth">medium</property>
                        <property name="borderTopStyle">solid</property>
                        <property name="borderTopWidth">medium</property>
                        <cell id="263">
                            <property name="borderBottomStyle">none</property>
                            <property name="borderLeftStyle">none</property>
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                            <property name="borderTopStyle">none</property>
                            <label id="272">
                                <text-property name="text">Start Time</text-property>
                            </label>
                        </cell>
                        <cell id="264">
                            <data id="319">
                                <structure name="dateTimeFormat">
                                    <property name="category">Custom</property>
                                    <property name="pattern">kk:mm:ss</property>
                                </structure>
                                <property name="resultSetColumn">start</property>
                            </data>
                        </cell>
                        <cell id="291">
                            <property name="borderLeftStyle">solid</property>
                            <property name="borderLeftWidth">medium</property>
                        </cell>
                        <cell id="301">
                            <property name="borderLeftStyle">solid</property>
                            <property name="borderLeftWidth">medium</property>
                        </cell>
                    </row>
                    <row id="287">
                        <property name="borderLeftStyle">solid</property>
                        <property name="borderLeftWidth">medium</property>
                        <property name="borderRightStyle">solid</property>
                        <property name="borderRightWidth">medium</property>
                        <cell id="288">
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                        </cell>
                        <cell id="289">
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                        </cell>
                        <cell id="292">
                            <data id="299">
                                <property name="resultSetColumn">inactivePeriods</property>
                            </data>
                        </cell>
                        <cell id="302">
                            <property name="borderLeftStyle">solid</property>
                            <property name="borderLeftWidth">medium</property>
                            <data id="316">
                                <property name="resultSetColumn">inactivePeriodDurations</property>
                            </data>
                        </cell>
                    </row>
                    <row id="265">
                        <property name="borderLeftStyle">solid</property>
                        <property name="borderLeftWidth">medium</property>
                        <property name="borderRightStyle">solid</property>
                        <property name="borderRightWidth">medium</property>
                        <cell id="266">
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                            <label id="273">
                                <text-property name="text">End Time</text-property>
                            </label>
                        </cell>
                        <cell id="267">
                            <data id="320">
                                <structure name="dateTimeFormat">
                                    <property name="category">Custom</property>
                                    <property name="pattern">kk:mm:ss</property>
                                </structure>
                                <property name="resultSetColumn">end</property>
                            </data>
                        </cell>
                        <cell id="293">
                            <property name="borderLeftStyle">solid</property>
                            <property name="borderLeftWidth">medium</property>
                        </cell>
                        <cell id="303">
                            <property name="borderLeftStyle">solid</property>
                            <property name="borderLeftWidth">medium</property>
                        </cell>
                    </row>
                    <row id="281">
                        <property name="borderBottomStyle">solid</property>
                        <property name="borderBottomWidth">medium</property>
                        <property name="borderLeftStyle">solid</property>
                        <property name="borderLeftWidth">medium</property>
                        <property name="borderRightStyle">solid</property>
                        <property name="borderRightWidth">medium</property>
                        <cell id="282">
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                            <label id="284">
                                <text-property name="text">Total time</text-property>
                            </label>
                        </cell>
                        <cell id="283">
                            <data id="286">
                                <property name="resultSetColumn">workDuration</property>
                            </data>
                        </cell>
                        <cell id="294">
                            <property name="borderLeftStyle">solid</property>
                            <property name="borderLeftWidth">medium</property>
                        </cell>
                        <cell id="304">
                            <property name="borderLeftStyle">solid</property>
                            <property name="borderLeftWidth">medium</property>
                            <data id="315">
                                <property name="resultSetColumn">inactiveDuration</property>
                            </data>
                        </cell>
                    </row>
                    <row id="277">
                        <property name="borderBottomStyle">solid</property>
                        <property name="borderBottomWidth">medium</property>
                        <property name="borderLeftStyle">solid</property>
                        <property name="borderLeftWidth">medium</property>
                        <property name="borderRightStyle">solid</property>
                        <property name="borderRightWidth">medium</property>
                        <cell id="278">
                            <property name="borderRightStyle">solid</property>
                            <property name="borderRightWidth">medium</property>
                            <label id="280">
                                <text-property name="text">Total working time</text-property>
                            </label>
                        </cell>
                        <cell id="279">
                            <data id="285">
                                <property name="resultSetColumn">activityDuration</property>
                            </data>
                        </cell>
                        <cell id="295">
                            <data id="317">
                                <property name="fontStyle">italic</property>
                                <property name="resultSetColumn">error</property>
                            </data>
                        </cell>
                        <cell id="305"/>
                    </row>
                </grid>
            </detail>
        </list>
    </body>
</report>
